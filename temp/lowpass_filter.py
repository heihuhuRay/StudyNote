# -*- encoding: UTF-8 -*-
import numpy as np
from scipy.signal import butter, lfilter, freqz
import matplotlib.pyplot as plt

class Butter_Filter(object):
    _data_ = None
    _order_ = 6
    _fs_ = 30.0       # sample rate, Hz
    _cutoff_ = 0.9  # desired cutoff frequency of the filter, Hz

    def butter_lowpass(self):
        nyq = 0.5 * self._fs_
        normal_cutoff = self._cutoff_ / nyq
        _b_, _a_ = butter(self._order_, normal_cutoff, btype='low', analog=False)
        return _b_, _a_
    
    def butter_lowpass_filter(self):
        butter_b, butter_a = self.butter_lowpass()
        filtered_data = lfilter(butter_b, butter_a, self._data_)
        return filtered_data
##########################################################################
################################  Test  ##################################
##########################################################################

rare_data = [1.5976446866989136, 1.9577605724334717, 1.0974751710891724, 1.4400852918624878, 1.5178394317626953, 2.0585691928863525, 1.670748233795166, 1.9543567895889282, 1.8811393976211548, 1.6029406785964966, 1.6525089740753174, 1.6138056516647339, 1.3726370334625244, 1.428883671760559, 1.2559740543365479, 1.4509706497192383, 1.3532484769821167, 1.4495254755020142, 1.5373523235321045, 1.6305882930755615, 1.8073381185531616, 1.7011620998382568, 1.906380295753479, 1.7047120332717896, 1.8860251903533936, 1.8489267826080322, 1.8527634143829346, 1.776435375213623, 1.6007049083709717, 1.7630034685134888, 1.7322112321853638, 1.731873631477356, 1.6811048984527588, 1.5945916175842285, 1.5890910625457764, 1.7666795253753662, 1.5545790195465088, 1.8120232820510864, 1.6450504064559937, 1.8582909107208252, 1.8734939098358154, 1.7150706052780151, 1.8746548891067505, 1.712484359741211, 1.8834233283996582, 1.8682606220245361, 1.69068443775177, 1.8127933740615845, 1.7388522624969482, 1.6492054462432861, 1.7951838970184326, 2.075510025024414, 1.978877067565918, 0.20630288124084473, 0.3753609359264374, 1.1087430715560913, 1.8068922758102417, 2.517195224761963, 2.8341031074523926, 2.654280185699463, 3.0331051349639893, 2.9345459938049316, 3.1935646533966064, 2.8118622303009033, 2.783933401107788, 2.6830341815948486, 2.8183059692382812, 2.831247568130493, 1.7948508262634277, 1.1109741926193237, 1.2730093002319336, 1.7523300647735596, 1.5708867311477661, 1.294867992401123, 0.880824089050293, 0.36160561442375183, 0.001237492193467915, 0.002927702385932207, 0.004083307459950447, 0.0, 0.003318826435133815, 0.0019924829248338938, 0.0034875457640737295, 0.002927702385932207, 0.003600391326472163, 0.0032347124069929123, 0.05902787670493126, 0.748772144317627, 2.87644624710083, 3.6908912658691406, 4.092930316925049, 4.5114946365356445, 3.5035455226898193, 2.7883195877075195, 2.5484795570373535, 2.0589921474456787, 1.578768253326416, 1.531783103942871, 2.1569290161132812, 2.5187082290649414, 3.0068717002868652, 2.6579158306121826, 2.5405099391937256, 2.7805752754211426, 2.8823704719543457, 3.656373977661133, 2.2589824199676514, 0.9790539145469666, 0.005476458463817835, 0.004169087391346693, 0.005182547029107809, 0.0037702161353081465, 0.0019924829248338938, 0.0008385518449358642, 0.004456257447600365, 0.0015863481676205993, 0.11325167864561081, 0.4698358476161957, 0.6223123669624329, 0.08499346673488617, 0.00147870066575706, 0.0034312265925109386, 0.20486478507518768, 0.561704158782959, 1.5437759160995483, 2.472020387649536, 3.1225955486297607, 3.4348537921905518, 3.0579700469970703, 3.3885695934295654, 2.080906867980957, 1.507828712463379, 0.9877247214317322, 0.6035612225532532, 0.6150949001312256, 1.0001357793807983, 1.4117900133132935, 1.739149808883667, 2.824263572692871, 3.0750732421875, 2.500615119934082, 1.8253278732299805, 2.057312488555908, 2.45242977142334, 2.571032762527466, 2.6149632930755615, 3.2156200408935547, 2.2255303859710693, 0.3517521023750305, 0.006641760468482971, 0.0034875457640737295, 0.004832424223423004, 0.0013981417287141085, 0.004716331139206886, 0.0034875457640737295, 0.0034875457640737295, 0.004687361419200897, 0.004398671444505453, 0.001210779999382794, 0.004803370218724012, 0.004513912368565798, 0.001290978048928082, 0.0008385518449358642, 0.0030390890315175056, 1.6632425785064697, 3.1345722675323486, 4.213315010070801, 4.3704352378845215, 4.463774681091309, 5.057905673980713, 4.521544933319092, 4.42692756652832, 3.946936845779419, 3.0903255939483643, 2.215653896331787, 1.7009133100509644, 1.450451135635376, 2.0656511783599854, 2.992776393890381, 2.783508777618408, 2.3856821060180664, 2.731635332107544, 2.544877052307129, 2.7256340980529785, 2.527892589569092, 3.1021463871002197, 3.7827751636505127, 2.397167921066284, 1.7473667860031128, 1.6913291215896606, 1.3515329360961914, 0.9209424257278442, 1.1602050065994263, 0.6190248727798462, 0.4110851287841797, 0.002183353528380394, 0.004026212729513645, 0.005594578571617603, 0.0025401257444173098, 0.003628646722063422, 0.003600391326472163, 0.05572925880551338, 0.37429580092430115, 0.8424112796783447, 1.3932297229766846, 1.837124228477478, 2.1157608032226562, 1.3829313516616821, 2.040343999862671, 1.888653039932251, 1.3411791324615479, 1.5456712245941162, 1.9032747745513916, 2.1397478580474854, 2.303997278213501, 2.7883195877075195, 3.119173288345337, 2.64617919921875, 2.9548161029815674, 2.46278715133667, 2.578763008117676, 2.4023678302764893, 2.995636224746704, 3.29367995262146, 1.0655865669250488, 0.003940708935260773, 0.005329260602593422, 0.000495846092235297, 0.004485073033720255, 0.005594578571617603, 0.002046928508207202, 0.004774339031428099, 0.004600552376359701, 0.0007592136971652508, 0.0027888817712664604, 0.006551028229296207, 0.0030948936473578215, 0.004948817193508148, 0.0005746851675212383, 0.27196434140205383, 0.21849171817302704, 0.9230751395225525, 2.0104830265045166, 3.0210206508636475, 3.524794578552246, 3.4608166217803955, 3.250643491744995, 2.5203704833984375, 1.1772722005844116, 0.2574349343776703, 0.018120406195521355, 0.35245460271835327, 1.111364722251892, 1.8522741794586182, 2.206171989440918, 3.005725383758545, 4.331006050109863, 3.3598337173461914, 2.6865243911743164, 2.581038236618042, 2.664186477661133, 2.4130048751831055, 3.6665382385253906, 1.9037376642227173, 0.2763761878013611, 0.008244248107075691, 0.0032627300824970007, 0.006219923961907625, 0.00428372947499156, 0.00147870066575706, 0.0035439261700958014, 0.034171879291534424, 0.0059210374020040035, 0.0029833612497895956, 0.21114367246627808, 0.21506240963935852, 0.07109089940786362, 0.11535043269395828, 0.2890983521938324, 0.410818487405777, 1.1025724411010742, 1.8290014266967773, 2.7489101886749268, 3.03631591796875, 3.0379462242126465, 2.4938294887542725, 1.7099261283874512, 1.085616111755371, 0.6476499438285828, 0.9385347366333008, 1.274685025215149, 1.6705303192138672, 2.278761863708496, 2.665794849395752, 3.2514703273773193, 3.15604567527771, 2.7695183753967285, 2.203174591064453, 1.638289213180542, 2.4885053634643555, 2.776463508605957, 3.4340319633483887, 1.4393953084945679, 0.11089888960123062, 0.0035439261700958014, 0.0024575244169682264, 0.002347642555832863, 0.0015594055876135826, 0.00033862097188830376, 0.00428372947499156, 0.00428372947499156, 0.024441804736852646, 0.057692140340805054, 0.38744643330574036, 0.7326821684837341, 0.6442441344261169, 0.0, 0.3634854853153229, 0.12483644485473633, 0.3648125231266022, 0.37289273738861084, 1.0094335079193115, 1.4173096418380737, 1.4311199188232422, 1.4783291816711426, 1.0948481559753418, 1.384698510169983, 1.3387391567230225, 1.633434534072876, 1.6225265264511108, 2.1522903442382812, 2.5584664344787598, 2.7699742317199707, 3.021712064743042, 3.4832606315612793, 2.631016731262207, 2.165689468383789, 1.3932318687438965, 2.4008398056030273, 2.715156316757202, 2.7956221103668213, 3.1068811416625977, 1.6266404390335083, 0.6936653256416321, 0.09589850157499313, 0.0021014432422816753, 0.5247829556465149, 0.6309928297996521, 0.7566930651664734, 0.6536110043525696, 0.3522988557815552, 0.44265228509902954, 0.47017863392829895, 0.29079219698905945, 0.0, 0.0008915232610888779, 0.0030948936473578215, 0.00039096278487704694, 0.00196528690867126, 0.00012991399853490293, 0.06495236605405807, 0.3925762176513672, 1.673485279083252, 3.084681987762451, 3.6606192588806152, 4.294188499450684, 4.385453701019287, 2.2881932258605957, 2.021738052368164, 2.0176329612731934, 1.9029223918914795, 1.9825942516326904, 2.074897289276123, 2.3371176719665527, 2.9506735801696777, 2.6511430740356445, 2.1840274333953857, 2.497688055038452, 2.5334713459014893, 2.565992593765259, 2.5500540733337402, 3.381467342376709, 1.2632172107696533, 0.004111877642571926, 0.0028721203561872244, 0.0004171605978626758, 0.005007132422178984, 0.0031507674138993025, 0.005742666777223349, 0.00039096278487704694, 0.0009711071033962071, 0.004083307459950447, 0.0007592136971652508, 0.003318826435133815, 0.0, 0.0005746851675212383, 0.4415874481201172, 0.4462662935256958, 1.7119567394256592, 3.1429824829101562]
b_f = Butter_Filter()
b_f._data_ = rare_data
filtered_data = b_f.butter_lowpass_filter()

b_f._data_ = filtered_data
filtered_data_2 = b_f.butter_lowpass_filter() 

fs = 30.0 
T = 5.0         # seconds
n = int(T * fs) # total number of samples
t = np.linspace(0, T, len(rare_data), endpoint=False)

plt.plot(t, rare_data, 'ob-', label='data')
plt.plot(t, filtered_data, 'og-', linewidth=2, label='filtered data')
#plt.plot(t, filtered_data_2, 'r-', linewidth=2, label='filtered data 2')

plt.xlabel('Time [sec]')
plt.grid()
plt.legend()
#plt.show()

